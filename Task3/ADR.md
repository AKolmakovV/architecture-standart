### **Название задачи: Концептуальная архитектура открытия депозитов для MVP**

### **Автор: Колмаков А.В.**

### **Дата: 13.09.2025**

### **Функциональные требования**


| **№** | **Действующие лица или системы** | **Use Case**                                                                 | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| :------: | :---------------------------------------------------------- | :----------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|  UC1  | клиент, сайт                                    | Подача заявки на депозит                                | 1. Пользователь открывает страницу сайта 2. Пользователь открывает раздел - оставить заявку на депозит 3. Пользователь заполняет все необходимые поля (ФИО, номер телефона) и нажимает кнопку "Отправить"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|  UC2  | клиент, интернет банк                   | Открытие депозита                                            | 1. Клиент открывает страницу веб приложения 2. Клиент вводит логин и пароль 3. Клиент нажимает кнопку "Вход" 4. Клиент видит интерфейс с доступными возожностями - просмотр ставок и открытия депозита 5. Клиент нажимает кнопку - открыть депозит 6. Клиенту предоставляют доступные условия 7. После ознакомления, клиент выбирает нужные условия, выбирает счет и сумму депозита и нажимает кнопку "Открыть депозит" 8. Клиенту отображается страница ввода кода подтверждения операции 8. Для подтверждения операции отправляется СМС код который необходио ввести в соответствующее поле ввода на странице подтверждения операции |
|  UC3  | абс, менеджер бэк офиса                | Фактическое открытие депозита                     | Заявку на открытие депозита обработает менеджер в бэк-офисе. Он подтвердит условия депозита в АБС банка. При этом клиент должен получить СМС-уведомления после подтверждения размера ставки и открытия депозита.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|  UC4  | абс, смс-шлюз,телеком оператор   | Уведомление по итогу оформления депозита | После подтверждения условий и открытия депозита клиент получает СМС об успешном оформлении                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

Опишите здесь нефункциональные требования и архитектурно значимые требования.


| **№** | **Требование**                                                                                                                                                                                                                                                                 |
| :------: | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|   P1   | Интерфейс должен быть отзывчивым (выставить требования к производительности)                                                                                                                                          |
|   P2   | Предусмотреть равномерное горизонтальное, а где нужно (АБС) - вертикальное масштабирование и распределение запросов между серверами, приложениями и ЦОД |
|   P3   | Сформировать требования к нагрузке (Нужен профиль нагрузки). Система должна выдерживать нагрузку.                                                                                                     |
|   R1   | Доступность 99.9%                                                                                                                                                                                                                                                             |
|   R2   | Повысить отказоустойчивость. У банка есть резервный ЦОД, в случае сбоя можно переключиться на него                                                                                                    |
|   R3   | Обеспечить транзакционную целостность данных                                                                                                                                                                                                    |
|   S1   | Реализация должна осуществляться на базе текущего технического стека (Java, MSSQL, ORACLE)                                                                                                                                  |
|   S2   | Реализовать функции мониторинга и логирования системы ( реализовать наблюдаемость системы )                                                                                                               |
|   S3   | Все сервисы должны иметь исчерпывающую документацию, подробный README, CHANGELOG, а архитектура должна быть задокументирована                                                              |
|   S4   | Перевод интернет банка на микросервисную архитектуру                                                                                                                                                                                      |
|   R1   | Фиксированный стек технологий (Java, MSSQL, .Net ASP.Net MVC, React, Oracle, PL/SQL)                                                                                                                                                                          |
|   R4   | Обеспечить шифрование трафика в интернет банке и на сайте                                                                                                                                                                               |

### <a name="_qmphm5d6rvi3"></a>**Решение**

- Диаграмма контекста: [C4 Диаграмма контекстов](./context_c4_diagram.puml)
- Диаграмма контейнеров: [С4 Диаграмма контейнеров](./container_c4_diagram.puml)

Мы реализуем архитектуру в рамках следующих ограничений:


| Код | Требования                                                                                                            | Комментарий |
| :------- | --------------------------------------------------------------------------------------------------------------------------------- | ------------------------ |
| +R     | + Ограничения (Restrictions)                                                                                         |                        |
| R1     | Фиксированный стек технологий (Java, MSSQL, .Net ASP.Net MVC, React, Oracle, PL/SQL)                 |                        |
| R2     | АБС масштабируется только вертикально                                                         |                        |
| R3     | Система кол-центра это платформа подрядчика, они же ее и дорабатывают |                        |
| R4     | Обеспечить шифрование трафика в интернет банке и на сайте                      |                        |

А также:

1. Нам требуется обеспечить отказоустойчивость нашего решения, для этого внедрим Load Balancer для переключения на резервный ЦОД в случае сбоя
2. Реализовать сервис депозитов - это позволит забрать нагрузку с АБС, и начать переход в контексте интернет-банка к микросервисам, что положительно повлияет на масштабирование и отказоустойчивость (при дальнейших доработках)
3. Что бы не потерять заявки в случае проблем, внедрим Kafka перед микросервисом депозитов
4. Нам требуется внедрить Prometheus, Jager и Grafana - изменения могут вызвать проблемы с производительностью, да и в принципе проблемы, требуется наблюдать (так как это не ключевая задача - мы не отразим на схеме явные связи с сервисами, но имеем ввиду)
5. Мы може внедрить кэш, для оптимизации нагрузки на сервис управления депозитами
6. На уровне сервиса депозитов реализовать Rate Limit, с учето того что перед сервисо стоит шина, решение будет надежным
7. Для сервиса депозитов предусмотреть горизонтальное масштабирование

Приемущество нашего решения в том что мы не меняем алгоритмы в работе полностью, мы встраиваемся в общую систему расширяя ее возможности.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

Альтернативные варианты:

1. На текущем этапе мы можем не внедрять Prometheus и Grafana - но это создает риски
2. Мы можем не выделять сервис депозитов, а все запросы интернет-банка и сайта пустить через систему кол-центра, так как процесс по сути уже готов, но кажется что мы можем перегрузить как АБС так и кол-центр
3. Мы може не делать кэш для сервиса депозитов, а понаблюдать за нагрузкой, постепенно переводя Сайт\Кол-Центр\Интернет банк - на сервис

**Недостатки, ограничения, риски**

1. Появляется активная разработка, нам потребуется отдел качества, тестовый полигон
2. Потребуется найм UI/UX специалистов для формирования постановок и рисования макетов интернет-банка
3. Возможно потребуется нанять еще разработчиков, текущее количество было - по факту, т.е. под имеющиеся задачи, сейчас появляются задачи разработки, а в дальнейшем поддержки сервисов
4. Усложняется инфраструктура, в целом повышается стоимость поддержки решения
